/*
	iio Engine v1.3.2 beta
	**********************
	Copyright 2014 Sebastian Bierman-Lytle. All rights reserved
*/
iio={};(function(){function e(){}function t(){this.App.apply(this,arguments)}function n(){this.Obj.apply(this,arguments)}iio.APP=0;iio.OBJ=1;iio.VEC=2;iio.LINE=3;iio.CIRCLE=4;iio.RECT=5;iio.POLY=6;iio.GRID=7;iio.TEXT=8;Array.prototype.insert=function(e,t){this.splice(e,0,t);return this};iio.inherit=function(t,n){var r=t;e.prototype=n.prototype;t.prototype=new e;t.prototype.constructor=r};iio.isNumber=function(e){return!isNaN(e-0)&&e!==null&&e!==""&&e!==false&&e!==true};iio.isString=function(e){return typeof e=="string"||e instanceof String};iio.randomColor=function(){return"rgb("+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+")"};iio.randomNum=function(e,t){e=e||0;t=t||1;return Math.random()*(t-e)+e};iio.randomInt=function(e,t){e=e||0;t=t||1;return Math.floor(Math.random()*(t-e))+e};iio.invertColor=function(e){var t=e.substr(e.indexOf(",")+1);var n=t.substr(t.indexOf(",")+1);return"rgb("+(255-parseInt(e.substr(e.indexOf("(")+1,e.indexOf(",")),10))+","+(255-parseInt(t.substr(0,t.indexOf(",")),10))+","+(255-parseInt(n.substr(0,n.indexOf(")")),10))+")"};iio.pointsToVecs=function(e){var t=[];if(!(e instanceof Array))e=[e];for(var n=0;n<e.length;n++){if(typeof e[n].x!="undefined")t.push(e[n]);else{t.push({x:e[n],y:e[n+1]});n++}}return t};iio.addEvent=function(e,t,n,r){if(e.addEventListener){e.addEventListener(t,n,r);return true}else if(e.attachEvent){e.attachEvent("on"+t,n);return true}else return false};iio.read=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,true);n.onreadystatechange=function(){if(n.readyState===4&&(n.status===200||n.status==0))t(n.responseText)};n.send(null)};iio.loop=function(e,t,n){if(iio.isNumber(e)||typeof window.requestAnimationFrame=="undefined"){function r(){var i=(new Date).getTime();var s=Math.floor(Math.max(0,1e3/e-(i-(t.last||0))));t.last=i+s;if(t.update)t.update(s);if(t.draw)t.draw();n(window.setTimeout(r,s),t,s/(1e3/e))}return window.setTimeout(r,1e3/e)}else{n=t;t=e;function i(){if(t.update)t.update();if(t.draw)t.draw();n(window.requestAnimationFrame(i),t,1)}return window.requestAnimationFrame(i)}};iio.app={};iio.start=function(e,t,n){var r;if(t){r=document.getElementById(t);if(!r){if(t.tagName=="CANVAS")r=t;else if(iio.isNumber(t)||t.x){r=document.createElement("canvas");r.width=t.x||t;r.height=t.y||t;n.appendChild(r)}}}else{document.body.style.margin=0;document.body.style.padding=0;r=document.createElement("canvas");r.margin=0;r.padding=0;r.style.position="absolute";r.width=window.innerWidth;r.height=window.innerHeight;document.body.appendChild(r);window.onresize=function(){r.width=window.innerWidth;r.height=window.innerHeight;r.parent.width=r.width;r.parent.height=r.height;r.parent.center.x=r.width/2;r.parent.center.y=r.height/2;r.parent.draw();if(r.parent.app.onresize)r.parent.app.onresize()}}if(e instanceof Array)return new iio.App(r,e[0],e[1]);if(iio.isString(e)&&e.substring(e.length-4)==".iio")return iio.read("App.iio",function(e){iio.start(e)});return new iio.App(r,e)};iio.scriptProps=[["app",1],["vel",1],["acc",1],["o",0],["center",1],["round",-1],["outline",2],["grid",3],["rotate",1],["alpha",1],["lineCap",1],["hidden",1],["dash",-1],["bezier",4],["shadow",3],["origin",1],["x",1]];iio.scriptFns=["add","loop","draw"];iio.operators=["/","%","*","+","-"];iio.scriptConsts=["randomColor"];iio.isConstant=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return true;return false};iio.isiioProp=function(e){for(var t=0;t<iio.scriptProps.length;t++)if(iio.scriptProps[t][0]==e)return true;return false};iio.isColor=function(e){for(var t=0;t<iio.operators.length;t++)if(e.indexOf(iio.operators[t])>-1)return false;if(iio.isNumber(e)||e.indexOf(":")>-1||e.indexOf("px")>-1||e=="width"||e=="height"||e=="center")return false;return true};iio.takesColor=function(e){if(e=="outline"||e=="color"||e=="shadow"||e=="app"||e=="grid"||e=="x")return true;return false};iio.maxParams=function(e){for(var t=0;t<iio.scriptProps.length;t++)if(iio.scriptProps[t][0]==e)return iio.scriptProps[t][1];return-1};iio.evaluate=function(e,t){if(!t)return 0;if(iio.isNumber(t))return parseFloat(t);else if(t=="center")return e.center;else if(t=="width")return e.width;else if(t=="height")return e.height;else if(t=="hidden")return e.hidden;else if(t=="randomColor")return iio.randomColor();var n;n=t.indexOf("-");if(n>-1)return iio.evaluate(e,t.substring(0,n))-iio.evaluate(e,t.substring(n+1));n=t.indexOf("+");if(n>-1)return iio.evaluate(e,t.substring(0,n))+iio.evaluate(e,t.substring(n+1));n=t.indexOf("/");if(n>-1)return iio.evaluate(e,t.substring(0,n))/iio.evaluate(e,t.substring(n+1));n=t.indexOf("*");if(n>-1)return iio.evaluate(e,t.substring(0,n))*iio.evaluate(e,t.substring(n+1));return t};iio.runiioFn=function(e,t){if(e[0]=="loop"){var n;if(iio.isNumber(e[1])){n=e.slice().splice(2,e.length);t.loop(e[1],function(){iio.run(n.slice(),t)})}else{n=e.slice().splice(1,e.length);t.loop(function(){iio.run(n.slice(),t)})}}else if(e[0]=="add"){var r=1;var n=[];var i=e[r].indexOf(":");while(e[r].indexOf("gradient")==-1&&i>-1&&i<e[r].length-1||e[r]=="center"){if(e[r]=="center")n.push(iio.evaluate(t,"center"));else{n.push(iio.evaluate(t,e[r].substring(0,i)));n.push(iio.evaluate(t,e[r].substring(i+1)))}r++;i=e[r].indexOf(":")}e.splice(0,r);r=1;var s=e[0];while(r<e.length)s+=" "+e[r++];return t.add(n,s)}else if(e[0]=="draw")t.draw()};iio.runiioProp=function(e,t){if(t[0]=="app"){var n;if(e.type!=iio.APP){var n=e.parent;while(n.type!=iio.APP)n=n.parent}else n=e;if(t[1])iio.run([t[1]],n,true)}else if(t[0]=="rotate")e.rot+=iio.evaluate(e,t[1]);else if(t[0]=="vel"||t[0]=="acc"){var r=t[1].split(":");if(t[0]=="vel"){e.vel.x=iio.evaluate(e,r[0]);e.vel.y=iio.evaluate(e,r[1]);e.vel.r=iio.evaluate(e,r[2])}else{e.acc.x=iio.evaluate(e,r[0]);e.acc.y=iio.evaluate(e,r[1]);e.acc.r=iio.evaluate(e,r[2])}}else if(t[0]=="o"){e.radius=e.width}else if(t[0]=="hidden"){if(t[1]){if(t[1]=="true")e.hidden=true;else e.hidden=false}else e.hidden=true}else if(t[0]=="round"){e.round=t[1];for(var i=2;i<t.length;i++)e.round+=" "+t[i]}else if(t[0]=="outline"){for(var i=1;i<t.length;i++)if(iio.isNumber(t[i].substring(0,1))||t[i].substring(0,1)=="-")e.lineWidth=iio.evaluate(e,t[i]);else if(t[i]=="randomColor")e.outline=iio.randomColor();else e.outline=t[i]}else if(t[0]=="alpha")e.alpha=t[1];else if(t[0]=="lineCap")e.lineCap=t[1];else if(t[0]=="shadow"){e.shadow=t[1];for(var i=2;i<t.length;i++)e.shadow+=" "+t[i]}else if(t[0]=="origin"){if(t[1]=="center")e.origin=e.center;else{var r=t[1].split(":");e.origin={x:r[0],y:r[1],r:r[2]}}}else if(t[0]=="dash"){for(var s=1;s<t.length;s++)t[s]=iio.evaluate(e,t[s]);e.dash=t.splice(1,t.length)}else if(t[0]=="bezier"){for(var s=1;s<=4;s++)t[s]=iio.evaluate(e,t[s]);e.bezier=t.splice(1,t.length)}else if(t[0]=="grid"){e.type=iio.GRID;for(var s=1;s<t.length;s++){var o=t[s].indexOf(":");if(o<0){var r=iio.evaluate(e,t[s]);if(iio.isString(r))e.gridColor=r;else{e.C=r;e.R=e.C}}else{var u=t[s].split(":");e.C=u[0];e.R=u[1]}e.res={x:e.width/e.C,y:e.height/e.R}}}else if(t[0]=="x")e.xColor=iio.evaluate(e,t[1])};iio.runiioConst=function(e,t){var n=t.indexOf(":");var r=t.indexOf("gradient");if(n>-1&&r==-1){e.width=iio.evaluate(e.parent,t.substring(0,n));e.height=n+1<t.length?iio.evaluate(e.parent,t.substring(n+1)):e.width;e.center.x=e.pos.x;e.center.y=e.pos.y}else if(t=="randomColor")e.color=iio.randomColor();else if(iio.isNumber(t.substring(0,1)))e.lineWidth=iio.evaluate(e,t);else if(t!="")e.color=t};iio.run=function(e,t,n){var r;if(e instanceof Array){while(e.length>0){if(iio.isConstant(iio.scriptFns,e[0])){var i=-1;for(var s=0;s<e.length;s++)if(e[s]=="|")i=s;if(i==-1){r=iio.runiioFn(e.slice(),t);i=e.length}else r=iio.runiioFn(e.slice().splice(0,i),t);e=e.splice(i+1,e.length)}else if(iio.isiioProp(e[0])){var o=0;var u;var a;u=[];u[0]=e[o];a=iio.maxParams(e[o++]);while(e[o]&&e[o]!="|"&&!(!iio.takesColor(e[0])&&iio.isColor(e[o]))&&(!iio.isiioProp(e[o])||e[o]=="round"&&e[0]=="lineCap"||e[0]=="origin"&&e[o]=="center")&&!(e[0]!="app"&&iio.isConstant(iio.scriptFns,e[o]))&&(o<=a||a==-1))u.push(e[o++]);iio.runiioProp(t,u.slice());e=e.splice(o,e.length)}else if(e[0]=="if"){var f=-1;var l=-1;for(var s=0;s<e.length;s++)if(e[s]=="else")f=s;for(var s=0;s<e.length;s++)if(e[s]=="then")l=s;if(iio.evaluate(t,e[1])){if(f>-1)iio.run(e.slice().splice(2,f-2),t,true);else if(l>-1)iio.run(e.slice().splice(2,l-2),t,true);else iio.run(e.slice().splice(2,e.length),t,true)}else if(f!=-1){if(l>-1)iio.run(e.slice().splice(f+1,l-f-1),t,true);else iio.run(e.slice().splice(f+1,e.length),t,true)}if(l>-1)e=e.splice(l+1,e.length);else e=[]}else if(e[0].substring(0,1)=="!"){e[0]=e[0].substring(1);if(e[0]=="hidden"){if(!t.hidden)t.hidden=true;else t.hidden=false;this.redraw=true;e=e.splice(1,e.length)}}else{iio.runiioConst(t,e[0]);e=e.splice(1,e.length)}}if(n);else t.draw()}else if(iio.isString(e)){r=iio.run(e.split(" "),t,true);if(n);else t.draw()}else{for(var a=0;a<t.length;a++)if(iio.isNumber(t[a]))e.lineWidth=iio.evaluate(e,t[a]);else e.color=t[a];if(n);else e.draw()}return r};init=function(){this.scale=1;this.objs=[];this.set=set;this.add=add;this.partialPx=true;this.run=function(e,t){return iio.run(e,this,t)};this.loop=function(e,t){if(this.looping){if(window.cancelAnimationFrame)window.cancelAnimationFrame(this.loopID);else window.clearTimeout(this.loopID)}this.looping=true;if(typeof t=="undefined"){if(typeof e=="undefined")this.loopID=iio.loop(this,this.update);else this.loopID=iio.loop(this,e)}else this.loopID=iio.loop(e,this,t)}};set=function(e,t){if(e instanceof Array)for(var n=0;n<e.length;n++)this.set(e[n],true);else if(iio.isString(e)){if(iio.isNumber(e)){}else iio.run(e.split(" "),this,true)}else for(var r in e)this[r]=e[r];if(t);else this.draw();return this};add=function(e,t,n,r){if(typeof e.type!="undefined"){if(e instanceof Array)for(var i=0;i<e.length;i++)this.add(e[i]);else if(e.z){var i=0;while(i<this.objs.length&&typeof this.objs[i].z!="undefined"&&e.z<=this.objs[i].z)i++;this.objs.insert(i,e)}else this.objs.push(e);e.parent=this;if(t);else this.draw();if((typeof this.looping=="undefined"||this.looping===false)&&(e.vel.x!=0||e.vel.y!=0||e.vel.r!=0||e.acc.x!=0||e.acc.y!=0||e.acc.r!=0))this.loop();return e}else{var s=this.add(new iio.Obj(e,t,n,this),true);if(r);else if(s.draw)s.draw();return s}};iio.addInputListeners=function(e){e.onmousedown=function(e){for(var t=0;t<this.parent.objs.length;t++){var n=this.parent.convertEventPos(e);if(this.parent.objs[t].contains&&this.parent.objs[t].contains(n))if(this.parent.objs[t].onmousedown){if(this.parent.objs[t].type==iio.GRID){var r=this.parent.objs[t].cellAt(n);this.parent.objs[t].onmousedown(n,r,this.parent.objs[t].cellCenter(r.c,r.r))}else this.parent.objs[t].onmousedown(n)}}}};iio.App=t;t.prototype.App=function(e,t,n){this.type=iio.APP;this.canvas=e;this.canvas.parent=this;iio.addInputListeners(this.canvas);this.ctx=e.getContext("2d");this.width=e.clientWidth;this.height=e.clientHeight;this.center={x:this.width/2,y:this.height/2};var r=e.getBoundingClientRect();this.pos={x:r.left,y:r.top};this.convertEventPos=function(e){return{x:e.clientX-this.pos.x,y:e.clientY-this.pos.y}};this.init=init;this.init();this.set(iio.app);if(iio.isString(t))this.app=iio.run(t,this);else this.app=new t(this,n)};t.prototype.draw=function(e){if(!e)this.ctx.clearRect(0,0,this.width,this.height);if(this.color){this.ctx.fillStyle=this.color;this.ctx.fillRect(0,0,this.width,this.height)}if(this.round&&this.canvas.style.borderRadius!=this.round){this.canvas.style.borderRadius=this.round}if(this.outline)this.canvas.style.border=(this.lineWidth||1)+"px solid "+this.outline;if(this.alpha)this.canvas.style.opacity=this.alpha;if(this.objs.length>0)for(var t=0;t<this.objs.length;t++)if(this.objs[t].draw)this.objs[t].draw(this.ctx)};t.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height);if(this.color){this.ctx.fillStyle=this.color;this.ctx.fillRect(0,0,this.width,this.height)}};t.prototype.update=function(e){if(this.objs&&this.objs.length>0)for(var t=0;t<this.objs.length;t++)if(this.objs[t].update)this.objs[t].update(e)};iio.Obj=n;n.prototype.Obj=function(e,t,n,r){this.parent=r;if(iio.isString(e)){this.text=e;this.type=iio.TEXT;this._draw=drawText;e=t;t=n}this.init=init;this.init();e=iio.pointsToVecs(e);this.pos=e[0];this.rot=0;this.center={x:this.pos.x,y:this.pos.y};this.vel={x:0,y:0,r:0};this.acc={x:0,y:0,r:0};this.update=function(e){iio.V.add(this.vel,this.acc);if(this.vel.x)this.pos.x+=this.vel.x;if(this.vel.y)this.pos.y+=this.vel.y;if(this.vel.r)this.rot+=this.vel.r;if(this.endPos)iio.V.add(this.endPos,this.vel);this.updateProps()};this.draw=function(e){if(this.hidden)return;if(!e){if(!this.parent)return;var t=this.parent;while(!e){e=t.ctx;t=t.parent}}if(this.looping&&this.parent&&this.parent.clear&&!this.parent.looping)this.parent.clear(e);e.save();if(this.origin)e.translate(this.origin.x,this.origin.y);else e.translate(this.pos.x,this.pos.y);if(this.rot!=0)e.rotate(this.rot);if(typeof this.alpha!="undefined")e.globalAlpha=this.alpha;if(this.lineCap)e.lineCap=this.lineCap;if(this.shadow){var n=this.shadow.split(" ");for(var r=0;r<n.length;r++){if(iio.isNumber(n[r]))e.shadowBlur=n[r];else if(n[r].indexOf(":")>-1){var i=n[r].indexOf(":");e.shadowOffsetX=n[r].substring(0,i);e.shadowOffsetY=n[r].substring(i+1)}else e.shadowColor=n[r]}}if(this.dash){if(this.dash.length>1&&this.dash.length%2==1)e.lineDashOffset=this.dash[this.dash.length-1];e.setLineDash(this.dash)}this._draw(e);if(this.objs.length>0){e.translate(-this.pos.x,-this.pos.y);for(var r=0;r<this.objs.length;r++)if(this.objs[r].draw)this.objs[r].draw(this.ctx)}e.restore()};if(e.length==2){this.type=iio.LINE;this.endPos=e[1];this.updateProps=function(){this.width=Math.abs(this.endPos.x-this.pos.x);this.height=Math.abs(this.endPos.y-this.pos.y);this.center.x=(this.pos.x+this.endPos.x)/2;this.center.y=(this.pos.y+this.endPos.y)/2};this.updateProps();this._draw=drawLine}else if(e.length>2){this.type=iio.POLY}else{if(this.radius){this.type=iio.CIRCLE;this._draw=drawCircle}else{this.type=iio.RECT;this.updateProps=function(){this.center=this.pos};if(iio.isString(t)&&t.indexOf("grid")>-1)this._draw=drawGrid;else this._draw=drawRect;this.contains=rectContains}}this.set(t,true);if(this.radius){this._draw=drawCircle;this.width*=2;this.height*=2}if(this.origin=="center")this.origin=this.center;if(this.R){this.cells=[];for(var i=0;i<this.C;i++){this.cells[i]=[];for(var r=0;r<this.R;r++)this.cells[i][r]={c:i,r:r}}this.cellCenter=function(e,t){return{x:this.pos.x-this.width/2+e*this.res.x+this.res.x/2,y:this.pos.y-this.height/2+t*this.res.y+this.res.y/2}};this.cellAt=function(e,t){if(e.x)return this.cells[Math.floor((e.x-this.left)/this.res.x)][Math.floor((e.y-this.top)/this.res.y)];else return this.cells[Math.floor((e-this.left)/this.res.x)][Math.floor((t-this.top)/this.res.y)]};this.left=this.pos.x-this.width/2;this.top=this.pos.y-this.height/2;this.foreachCell=function(e,t){var n=true;for(var r=0;r<this.C;r++)for(var i=0;i<this.R;i++){n=e(this.cells[r][i],t);if(typeof n!="undefined"&&!n)return[i,r]}}}};drawCircle=function(e){iio.startShape(e,this);e.beginPath();e.arc(0,0,this.radius,0,2*Math.PI,false);if(this.color)e.fill();if(this.outline)e.stroke();e.restore()};drawLine=function(e){e.save();e.strokeStyle=this.color;e.lineWidth=this.lineWidth;if(this.origin)e.translate(-this.origin.x,-this.origin.y);else e.translate(-this.pos.x,-this.pos.y);e.beginPath();e.moveTo(this.pos.x,this.pos.y);if(this.bezier)e.bezierCurveTo(this.bezier[0],this.bezier[1],this.bezier[2],this.bezier[3],this.endPos.x,this.endPos.y);else e.lineTo(this.endPos.x,this.endPos.y);e.stroke();e.restore()};iio.createGradient=function(e,t,n){var r;var i=n.split(":");var s=i[1].split(",");if(s.length==4)r=e.createLinearGradient(iio.evaluate(t,s[0]),iio.evaluate(t,s[1]),iio.evaluate(t,s[2]),iio.evaluate(t,s[3]));else r=e.createRadialGradient(iio.evaluate(t,s[0]),iio.evaluate(t,s[1]),iio.evaluate(t,s[2]),iio.evaluate(t,s[3]),iio.evaluate(t,s[4]),iio.evaluate(t,s[5]));var o;for(var u=2;u<i.length;u++){o=i[u].indexOf(",");r.addColorStop(parseFloat(i[u].substring(0,o)),iio.evaluate(t,i[u].substring(o+1)))}t.color="g";return r};iio.startShape=function(e,t){e.save();if(t.color){if(t.color.indexOf("gradient")>-1){t.colorGradient=iio.createGradient(e,t,t.color);e.fillStyle=t.colorGradient}else if(t.colorGradient)e.fillStyle=t.colorGradient;else e.fillStyle=t.color}if(t.outline){e.lineWidth=t.lineWidth;if(t.outlineGradient){e.strokeStyle=t.outlineGradient}else if(t.outline.indexOf("gradient")>-1){t.outlineGradient=iio.createGradient(e,t,t.outline);e.strokeStyle=t.outlineGradient}else e.strokeStyle=t.outline}};iio.drawLine=function(e,t,n,r,i){e.beginPath();e.moveTo(t,n);e.lineTo(r,i);e.stroke()};drawRect=function(e){iio.startShape(e,this);if(this.color)e.fillRect(-this.width/2,-this.height/2,this.width,this.height);if(this.outline)e.strokeRect(-this.width/2,-this.height/2,this.width,this.height);if(this.xColor){e.save();e.strokeStyle=this.xColor;e.lineWidth=this.lineWidth;e.translate(-this.width/2,-this.height/2);iio.drawLine(e,0,0,this.width,this.height);iio.drawLine(e,this.width,0,0,this.height);e.restore()}e.restore()};rectContains=function(e,t){t=e.y||t;e=e.x||e;e-=this.pos.x;t-=this.pos.y;if(e>-this.width/2&&e<this.width/2&&t>-this.height/2&&t<this.height/2)return true;return false};drawGrid=function(e){iio.startShape(e,this);e.translate(-this.width/2,-this.height/2);if(this.color)e.fillRect(0,0,this.width,this.height);e.strokeStyle=this.gridColor;e.lineWidth=this.lineWidth;for(var t=1;t<this.C;t++)iio.drawLine(e,t*this.res.x,0,t*this.res.x,this.height);for(var n=1;n<this.R;n++)iio.drawLine(e,0,n*this.res.y,this.width,n*this.res.y);if(this.outline&&this.lineWidth){e.strokeStyle=this.outline;e.strokeRect(0,0,this.width,this.height)}e.restore()};drawText=function(e){e.font="10px Consolas";e.textAlign="center";e.fillStyle="white";e.fillText(this.text,0,0)};iio.V={};iio.V.add=function(e,t){for(var n in t)if(e[n])e[n]+=t[n]}})()