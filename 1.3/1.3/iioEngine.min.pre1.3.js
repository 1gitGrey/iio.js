/* 
	iio Engine v1.3.3 beta
	**********************
	Copyright 2014 Sebastian Bierman-Lytle All Rights Reserved.

	the source code for 1.3 is not yet available for download
	DONT USE THIS CODE FOR ANY PURPOSE EXCEPT TO RUN iio DEMOS
*/iio={};(function(){function e(){}function t(){this.App.apply(this,arguments)}function n(){this.Obj.apply(this,arguments)}iio.APP=0;iio.OBJ=1;iio.LINE=2;iio.CIRC=3;iio.RECT=4;iio.POLY=5;iio.GRID=6;iio.TEXT=7;Array.prototype.insert=function(e,t){this.splice(e,0,t);return this};iio.inherit=function(t,n){var r=t;e.prototype=n.prototype;t.prototype=new e;t.prototype.constructor=r};iio.isNumber=function(e){return!isNaN(e-0)&&e!==null&&e!==""&&e!==false&&e!==true};iio.isString=function(e){return typeof e=="string"||e instanceof String};iio.isImage=function(e){var t=["png","jpg","gif","tiff"];for(var n=0;n<t.length;n++)if(e.indexOf("."+t[n])!=-1)return true;return false};iio.randomColor=function(){return"rgb("+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+")"};iio.random=function(e,t){e=e||0;t=t===0||typeof t!="undefined"?t:1;return Math.random()*(t-e)+e};iio.randomInt=function(e,t){e=e||0;t=t||1;return Math.floor(Math.random()*(t-e))+e};iio.invertColor=function(e){var t=e.substr(e.indexOf(",")+1);var n=t.substr(t.indexOf(",")+1);return"rgb("+(255-parseInt(e.substr(e.indexOf("(")+1,e.indexOf(",")),10))+","+(255-parseInt(t.substr(0,t.indexOf(",")),10))+","+(255-parseInt(n.substr(0,n.indexOf(")")),10))+")"};iio.load=function(e,t){var n=new Image;n.src=e;n.onload=t;return n};iio.pointsToVecs=function(e){var t=[];if(!(e instanceof Array))e=[e];for(var n=0;n<e.length;n++){if(typeof e[n].x!="undefined")t.push(e[n]);else{t.push({x:e[n],y:e[n+1]});n++}}return t};iio.addEvent=function(e,t,n,r){if(e.addEventListener){e.addEventListener(t,n,r);return true}else if(e.attachEvent){e.attachEvent("on"+t,n);return true}else return false};iio.read=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,true);n.onreadystatechange=function(){if(n.readyState===4&&(n.status===200||n.status==0))t(n.responseText)};n.send(null)};iio.loop=function(e,t,n){if(iio.isNumber(e)||typeof window.requestAnimationFrame=="undefined"||!e.rqAnimFrame){if(typeof e.rqAnimFrame!="undefined"){n=t;t=e;e=60}function r(){var i=(new Date).getTime();var s=Math.floor(Math.max(0,1e3/e-(i-(t.last||0))));t.last=i+s;if(t._update)t._update(s);if(t.draw)t.draw();n(window.setTimeout(r,s),t,s/(1e3/e))}return window.setTimeout(r,1e3/e)}else{n=t;t=e;function i(){if(t._update)t._update();if(t.draw)t.draw();n(window.requestAnimationFrame(i),t,1)}return window.requestAnimationFrame(i)}};iio.getKeyString=function(e){switch(e.keyCode){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"ctrl";case 18:return"alt";case 19:return"pause";case 20:return"caps lock";case 27:return"escape";case 32:return"space";case 33:return"page up";case 34:return"page down";case 35:return"end";case 36:return"home";case 37:return"left arrow";case 38:return"up arrow";case 39:return"right arrow";case 40:return"down arrow";case 45:return"insert";case 46:return"delete";case 48:return"0";case 49:return"1";case 50:return"2";case 51:return"3";case 52:return"4";case 53:return"5";case 54:return"6";case 55:return"7";case 56:return"8";case 57:return"9";case 65:return"a";case 66:return"b";case 67:return"c";case 68:return"d";case 69:return"e";case 70:return"f";case 71:return"g";case 72:return"h";case 73:return"i";case 74:return"j";case 75:return"k";case 76:return"l";case 77:return"m";case 78:return"n";case 79:return"o";case 80:return"p";case 81:return"q";case 82:return"r";case 83:return"s";case 84:return"t";case 85:return"u";case 86:return"v";case 87:return"w";case 88:return"x";case 89:return"y";case 90:return"z";case 91:return"left window";case 92:return"right window";case 93:return"select key";case 96:return"n0";case 97:return"n1";case 98:return"n2";case 99:return"n3";case 100:return"n4";case 101:return"n5";case 102:return"n6";case 103:return"n7";case 104:return"n8";case 105:return"n9";case 106:return"multiply";case 107:return"add";case 109:return"subtract";case 110:return"dec";case 111:return"divide";case 112:return"f1";case 113:return"f2";case 114:return"f3";case 115:return"f4";case 116:return"f5";case 117:return"f6";case 118:return"f7";case 119:return"f8";case 120:return"f9";case 121:return"f10";case 122:return"f11";case 123:return"f12";case 144:return"num lock";case 156:return"scroll lock";case 186:return"semi-colon";case 187:return"equal";case 188:return"comma";case 189:return"dash";case 190:return"period";case 191:return"forward slash";case 192:return"grave accent";case 219:return"open bracket";case 220:return"back slash";case 221:return"close bracket";case 222:return"single quote";default:return"undefined"}};iio.keyCodeIs=function(e,t){if(!(e instanceof Array))e=[e];var n=iio.getKeyString(t);for(var r=0;r<e.length;r++){if(n==e[r])return true}return false};iio.apps=[];iio.start=function(e,t,n){var r;if(t){r=document.getElementById(t);if(!r){if(t.tagName=="CANVAS")r=t;else if(iio.isNumber(t)||t.x){r=document.createElement("canvas");r.width=t.x||t;r.height=t.y||t;n.appendChild(r)}}}else{document.body.style.margin=0;document.body.style.padding=0;r=document.createElement("canvas");r.margin=0;r.padding=0;r.style.position="absolute";r.width=window.innerWidth;r.height=window.innerHeight;document.body.appendChild(r);window.onresize=function(){r.width=window.innerWidth;r.height=window.innerHeight;r.parent.width=r.width;r.parent.height=r.height;r.parent.center.x=r.width/2;r.parent.center.y=r.height/2;r.parent.draw();if(r.parent.app.onresize)r.parent.app.onresize()}}if(e instanceof Array)return new iio.App(r,e[0],e[1]);if(iio.isString(e)&&e.substring(e.length-4)==".iio")return iio.read("App.iio",function(e){iio.start(e)});return new iio.App(r,e)};iio.scriptProps=[["app",1],["vel",1],["acc",1],["o",0],["z",1],["round",-1],["outline",2],["grid",3],["rotate",1],["alpha",1],["lineCap",1],["hidden",1],["dash",-1],["bezier",4],["shadow",3],["origin",1],["font",1],["x",2],["cursor",0]];iio.scriptFns=["add","loop","draw"];iio.operators=["/","%","*","+","-"];iio.scriptConsts=["randomColor"];iio.isKey=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return true;return false};iio.isiioProp=function(e){for(var t=0;t<iio.scriptProps.length;t++)if(iio.scriptProps[t][0]==e)return true;return false};iio.isColor=function(e){for(var t=0;t<iio.operators.length;t++)if(e.indexOf(iio.operators[t])>-1)return false;if(iio.isNumber(e)||e.indexOf(":")>-1||e.indexOf("px")>-1||e=="width"||e=="height"||e=="center")return false;return true};iio.takesOther=function(e){if(e=="outline"||e=="color"||e=="shadow"||e=="app"||e=="grid"||e=="x"||e=="font")return true;return false};iio.maxParams=function(e){for(var t=0;t<iio.scriptProps.length;t++)if(iio.scriptProps[t][0]==e)return iio.scriptProps[t][1];return-1};iio.runiioFn=function(e,t){if(e[0]=="loop"){var n;if(iio.isNumber(e[1])){n=e.slice().splice(2,e.length);t.loop(e[1],function(){iio.run(n.slice(),t)})}else{n=e.slice().splice(1,e.length);t.loop(function(){iio.run(n.slice(),t)})}}else if(e[0]=="add"){var r=1;var n=[];var i=e[r].indexOf(":");while(e[r].indexOf("gradient")==-1&&i>-1&&i<e[r].length-1||e[r]=="center"){if(e[r]=="center")n.push(t.eval("center"));else{n.push(t.eval(e[r].substring(0,i)));n.push(t.eval(e[r].substring(i+1)))}r++;i=e[r].indexOf(":")}e.splice(0,r);r=1;var s=e[0];while(r<e.length)s+=" "+e[r++];return t.add(n,s)}else if(e[0]=="draw")t.app.draw()};iio.runiioProp=function(e,t){if(t[0]=="app"){var n;if(e.type!=iio.APP){var n=e.parent;while(n.type!=iio.APP)n=n.parent}else n=e;if(t[1])iio.run([t[1]],n,true)}else if(t[0]=="rotate")e.rot+=e.eval(t[1]);else if(t[0]=="vel"||t[0]=="acc"){var r=t[1].split(":");if(t[0]=="vel"){e.vel.x=e.eval(r[0]);e.vel.y=e.eval(r[1]);e.vel.r=e.eval(r[2])}else{e.acc.x=e.eval(r[0]);e.acc.y=e.eval(r[1]);e.acc.r=e.eval(r[2])}}else if(t[0]=="o"){e.type=iio.CIRC}else if(t[0]=="z"){e.z=parseFloat(t[1])}else if(t[0]=="hidden"){if(t[1]){if(t[1]=="true")e.hidden=true;else e.hidden=false}else e.hidden=true}else if(t[0]=="round"){if(e.type==iio.APP){e.round=t[1];for(var i=2;i<t.length;i++)e.round+=" "+t[i]}else{if(t.length==2)e.round=[t[1],t[1],t[1],t[1]];else if(t.length==3)e.round=[t[1],t[2],t[1],t[2]];else e.round=[t[1],t[2],t[3],t[4]]}}else if(t[0]=="outline"){for(var i=1;i<t.length;i++)if(iio.isNumber(t[i].substring(0,1))||t[i].substring(0,1)=="-")e.lineWidth=e.eval(t[i]);else if(t[i]=="randomColor")e.outline=iio.randomColor();else e.outline=t[i]}else if(t[0]=="alpha")e.alpha=t[1];else if(t[0]=="lineCap")e.lineCap=t[1];else if(t[0]=="shadow"){e.shadow=t[1];for(var i=2;i<t.length;i++)e.shadow+=" "+t[i]}else if(t[0]=="origin"){if(t[1]=="center")e.origin=e.center;else{var r=t[1].split(":");e.origin={x:r[0],y:r[1],r:r[2]}}}else if(t[0]=="dash"){for(var s=1;s<t.length;s++)t[s]=e.eval(t[s]);e.dash=t.splice(1,t.length)}else if(t[0]=="bezier"){for(var s=1;s<=4;s++)t[s]=e.parent.eval(t[s]);e.bezier=t.splice(1,t.length)}else if(t[0]=="grid"){e.type=iio.GRID;for(var s=1;s<t.length;s++){var o=t[s].indexOf(":");if(o<0){var r=e.eval(t[s]);if(iio.isString(r))e.gridColor=r;else{e.C=r;e.R=e.C}}else{var u=t[s].split(":");e.C=u[0];e.R=u[1]}e.res={x:e.width/e.C,y:e.height/e.R}}}else if(t[0]=="x"){if(t.length==1)e.xColor=e.color||e.outline;else for(var s=1;s<t.length;s++)if(iio.isNumber(t[s]))e.lineWidth=e.eval(t[s]);else e.xColor=e.eval(t[s])}else if(t[0]=="font")e.font=t[1];else if(t[0]=="cursor")e.showCursor=true};iio.runiioConst=function(e,t){var n=t.indexOf(":");var r=t.indexOf("gradient");if(n>-1&&r==-1){e.width=e.parent.eval(t.substring(0,n));e.height=n+1<t.length?e.parent.eval(t.substring(n+1)):e.width;e.center.x=e.pos.x;e.center.y=e.pos.y}else if(t=="randomColor")e.color=iio.randomColor();else if(iio.isNumber(t.substring(0,1))){if(e.type==iio.LINE)e.lineWidth=e.eval(t);else e.width=e.height=e.eval(t)}else if(iio.isImage(t))e.img=t;else if(t=="center"||t=="left"||t=="right"||t=="end")e.align=t;else if(t!="")e.color=t};iio.run=function(e,t){var n;if(e instanceof Array){while(e.length>0){if(iio.isKey(iio.scriptFns,e[0])){var r=-1;for(var i=0;i<e.length;i++)if(e[i]=="|")r=i;if(r==-1){n=iio.runiioFn(e.slice(),t);r=e.length}else n=iio.runiioFn(e.slice().splice(0,r),t);e=e.splice(r+1,e.length)}else if(iio.isiioProp(e[0])){var s=0;var o;var u;o=[];o[0]=e[s];u=iio.maxParams(e[s++]);while(e[s]&&e[s]!="|"&&!(!iio.takesOther(e[0])&&iio.isColor(e[s]))&&(!iio.isiioProp(e[s])||e[s]=="round"&&e[0]=="lineCap"||e[0]=="origin"&&e[s]=="center")&&!(e[0]!="app"&&iio.isKey(iio.scriptFns,e[s]))&&(s<=u||u==-1))o.push(e[s++]);iio.runiioProp(t,o.slice());e=e.splice(s)}else if(e[0].charAt(0)=='"'||e[0].charAt(0)=="'"){var a=e[0].charAt(0);var u=0;if(e[u].charAt(e[u].length-1)==a)t.text=e[u].substring(1,e[u].length-1);else{var f=e[0].substring(1);var u=1;while(u<e.length&&e[u].charAt(e[u].length-1)!=a){f+=" "+e[u];u++}t.text=f+" "+e[u].substring(0,e[u].length-1)}e=e.splice(u+1)}else if(e[0]=="if"){var l=-1;var f=-1;for(var i=0;i<e.length;i++)if(e[i]=="else")l=i;for(var i=0;i<e.length;i++)if(e[i]=="then")f=i;if(t.eval(e[1])){if(l>-1)iio.run(e.slice().splice(2,l-2),t,true);else if(f>-1)iio.run(e.slice().splice(2,f-2),t,true);else iio.run(e.slice().splice(2,e.length),t,true)}else if(l!=-1){if(f>-1)iio.run(e.slice().splice(l+1,f-l-1),t,true);else iio.run(e.slice().splice(l+1,e.length),t,true)}if(f>-1)e=e.splice(f+1,e.length);else e=[]}else if(e[0].substring(0,1)=="!"){e[0]=e[0].substring(1);if(e[0]=="hidden"){if(!t.hidden)t.hidden=true;else t.hidden=false;e=e.splice(1,e.length)}}else{iio.runiioConst(t,e[0]);e=e.splice(1)}}}else if(iio.isString(e))n=iio.run(e.split(" "),t);else{for(var u=0;u<t.length;u++)if(iio.isNumber(t[u]))e.lineWidth=e.eval(t[u]);else e.color=t[u]}return n};init=function(){this.scale=1;this.objs=[];this.set=set;this.add=add;this.rmv=rmv;this.rqAnimFrame=true;this.partialPx=true;this.run=function(e,t){return iio.run(e,this,t)};this.loop=function(e,t){if(this.looping){if(window.cancelAnimationFrame&&this.rqAnimFrame)window.cancelAnimationFrame(this.loopID);else window.clearTimeout(this.loopID)}this.looping=true;if(typeof t=="undefined"){if(typeof e=="undefined")this.loopID=iio.loop(this,this._update);else this.loopID=iio.loop(this,e)}else this.loopID=iio.loop(e,this,t)};this.eval=function(e){if(!e)return 0;if(iio.isNumber(e))return parseFloat(e);else if(e=="center")return this.center;else if(e=="width")return this.width;else if(e=="height")return this.height;else if(e=="hidden")return this.hidden;else if(e=="randomColor")return iio.randomColor();var t;t=e.indexOf("-");if(t>-1)return this.eval(e.substring(0,t))-this.eval(e.substring(t+1));t=e.indexOf("+");if(t>-1)return this.eval(e.substring(0,t))+this.eval(e.substring(t+1));t=e.indexOf("/");if(t>-1)return this.eval(e.substring(0,t))/this.eval(e.substring(t+1));t=e.indexOf("*");if(t>-1)return this.eval(e.substring(0,t))*this.eval(e.substring(t+1));return e}};iio.set=function(e,t){for(var n=0;n<e.length;n++)e[n].set(t)};set=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++)this.set(e[t],true);else if(iio.isString(e)){if(iio.isNumber(e)){}else iio.run(e.split(" "),this,true)}else for(var n in e)this[n]=e[n];if(this.text)this.type=iio.TEXT;if(this.simple){if(!(this.bbx instanceof Array)){this.bbx=[this.bbx,this.bbx]}else if(typeof (this.bbx[1]=="undefined"))this.bbx[1]=this.bbx[0]}if(this.img&&iio.isString(this.img)){var r=this.img;this.img=new Image;this.img.src=r;this.img.parent=this;if(typeof this.width=="undefined"&&typeof this.radius=="undefined"||this.radius==0)this.img.onload=function(e){if(this.parent.radius==0)this.parent.radius=this.width/2;else{this.parent.width=this.width||0;this.parent.height=this.height||0}this.parent.app.draw()}}else if(this.img){if(typeof this.width=="undefined"&&typeof this.radius=="undefined"||this.radius==0){if(this.radius==0)this.radius=this.img.width/2;else{this.width=this.img.width||0;this.height=this.img.height||0}this.app.draw()}}if((this.vel&&(this.vel.x!=0||this.vel.y!=0||this.vel.r!=0)||this.acc&&(this.acc.x!=0||this.acc.y!=0||this.acc.r!=0))&&(typeof this.app.looping=="undefined"||this.app.looping===false))this.app.loop();return this};add=function(e,t,n){if(e instanceof Array&&!iio.isNumber(e[0])&&typeof e[0].x=="undefined")for(var r=0;r<e.length;r++)this.add(e[r],t,n);else if(typeof e.type!="undefined"){e.parent=this;e.app=this.app;if(typeof e.z=="undefined")e.z=0;var r=0;while(r<this.objs.length&&typeof this.objs[r].z!="undefined"&&e.z>=this.objs[r].z)r++;this.objs.insert(r,e)}else e=this.add(new iio.Obj(e,t,n,this));this.app.draw();return e};rmv=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++)this.rmv(e[t]);if(iio.isNumber(e))this.objs.splice(e,1);else if(this.objs)for(var t=0;t<this.objs.length;t++)if(this.objs[t]==e){this.objs.splice(t,1);break}if(this.collisions)for(var t=0;t<this.collisions.length;t++){if(this.collisions[t][0]==e||this.collisions[t][1]==e){this.collisions.splice(t,1);return e}if(this.collisions[t][0]instanceof Array)for(var n=0;n<this.collisions[t][0].length;n++)if(this.collisions[t][0][n]==e){this.collisions[t][0].splice(n,1);return e}if(this.collisions[t][1]instanceof Array)for(var n=0;n<this.collisions[t][1].length;n++)if(this.collisions[t][1][n]==e){this.collisions[t][1].splice(n,1);return e}}};iio.addInputListeners=function(e){e.onmousedown=function(e){var t=this.parent.convertEventPos(e);if(this.parent.onmousedown)this.parent.onmousedown(e,t);for(var n=0;n<this.parent.objs.length;n++){if(n!==0)t=this.parent.convertEventPos(e);if(this.parent.objs[n].contains&&this.parent.objs[n].contains(t))if(this.parent.objs[n].onmousedown){if(this.parent.objs[n].type==iio.GRID){var r=this.parent.objs[n].cellAt(t);this.parent.objs[n].onmousedown(t,r,this.parent.objs[n].cellCenter(r.c,r.r))}else this.parent.objs[n].onmousedown(e,t)}}}};iio.addEvent(window,"keydown",function(e){var t=iio.getKeyString(e);for(var n=0;n<iio.apps.length;n++)if(iio.apps[n].runScript.onKeyDown)iio.apps[n].runScript.onKeyDown(e,t)});iio.addEvent(window,"keyup",function(e){var t=iio.getKeyString(e);for(var n=0;n<iio.apps.length;n++)if(iio.apps[n].runScript.onKeyUp)iio.apps[n].runScript.onKeyUp(e,t)});iio.App=t;t.prototype.App=function(e,t,n){this.type=iio.APP;this.canvas=e;this.canvas.parent=this;iio.addInputListeners(this.canvas);this.ctx=e.getContext("2d");this.width=e.clientWidth;this.height=e.clientHeight;this.center={x:this.width/2,y:this.height/2};var r=e.getBoundingClientRect();this.pos={x:r.left,y:r.top};this.convertEventPos=function(e){return{x:e.clientX-this.pos.x,y:e.clientY-this.pos.y}};this.init=init;this.init();this.collisions=[];this.app=this;iio.apps.push(this);if(iio.isString(t))this.runScript=iio.run(t,this);else this.runScript=new t(this,n)};t.prototype.draw=function(e){if(!e)this.ctx.clearRect(0,0,this.width,this.height);if(this.color){this.ctx.fillStyle=this.color;this.ctx.fillRect(0,0,this.width,this.height)}if(this.round&&this.canvas.style.borderRadius!=this.round){this.canvas.style.borderRadius=this.round}if(this.outline)this.canvas.style.border=(this.lineWidth||1)+"px solid "+this.outline;if(this.alpha)this.canvas.style.opacity=this.alpha;if(this.objs.length>0)for(var t=0;t<this.objs.length;t++)if(this.objs[t].draw)this.objs[t].draw(this.ctx)};t.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height);if(this.color){this.ctx.fillStyle=this.color;this.ctx.fillRect(0,0,this.width,this.height)}};t.prototype.collision=function(e,t,n){this.collisions.push([e,t,n])};t.prototype.cCollisions=function(e,t,n){if(e instanceof Array){if(t instanceof Array){if(t.length==0)return;for(var r=0;r<e.length;r++)for(var i=0;i<t.length;i++)if(iio.checkCollision(e[r],t[i]))n(e[r],t[i])}else{for(var s=0;s<e.length;s++)if(iio.checkCollision(e[s],t))n(e[s],t)}}else{if(t instanceof Array){for(var s=0;s<t.length;s++)if(iio.checkCollision(e,t[s]))n(e,t[s])}else if(iio.checkCollision(e,t))n(e,t)}};t.prototype._update=function(e){if(this.update)this.update(e);if(this.objs&&this.objs.length>0)for(var t=0;t<this.objs.length;t++)if(this.objs[t]._update)if(this.objs[t]._update(e))this.rmv(this.objs[t]);if(this.collisions&&this.collisions.length>0){for(var t=0;t<this.collisions.length;t++)this.cCollisions(this.collisions[t][0],this.collisions[t][1],this.collisions[t][2])}};iio.checkCollision=function(e,t){if(typeof e=="undefined"||typeof t=="undefined")return false;if(e.type==iio.RECT&&t.type==iio.RECT){if(e.simple){if(t.simple)return iio.rectXrect(e.pos.x-e.bbx[0],e.pos.x+e.bbx[0],e.pos.y-(e.bbx[1]||e.bbx[0]),e.pos.y+(e.bbx[1]||e.bbx[0]),t.pos.x-t.bbx[0],t.pos.x+t.bbx[0],t.pos.y-(t.bbx[1]||t.bbx[0]),t.pos.y+(t.bbx[1]||t.bbx[0]));else return iio.rectXrect(e.pos.x-e.bbx[0],e.pos.x+e.bbx[0],e.pos.y-(e.bbx[1]||e.bbx[0]),e.pos.y+(e.bbx[1]||e.bbx[0]),t.left,t.right,t.top,t.bottom)}else if(t.simple)return iio.rectXrect(e.left,e.right,e.top,e.bottom,t.pos.x-t.bbx[0],t.pos.x+t.bbx[0],t.pos.y-(t.bbx[1]||t.bbx[0]),t.pos.y+(t.bbx[1]||t.bbx[0]));else return iio.rectXrect(e.left,e.right,e.top,e.bottom,t.left,t.right,t.top,t.bottom)}};iio.rectXrect=function(e,t,n,r,i,s,o,u){if(e<s&&t>i&&n<u&&r>o)return true;return false};iio.Obj=n;n.prototype.Obj=function(e,t,n,r){if(iio.isString(e)){if(typeof r=="undefined")r=n;n=t;t=e;e={x:0,y:0}}if(r){this.parent=r;this.app=r.app}this.init=init;this.init();e=iio.pointsToVecs(e);this.pos=e[0];if(e.length==2)this.type=iio.LINE;this.center={x:0,y:0};this.rot=0;this.vel={x:0,y:0,r:0};this.acc={x:0,y:0,r:0};t=[t,n];this.set(t,true);if(e.length>2){this.vs=e;iio.initPoly(this)}else if(e.length==2){this.endPos=e[1];iio.initLine(this)}else{if(this.type==iio.TEXT)iio.initText(this);else if(this.type==iio.CIRC)iio.initCirc(this);else{iio.initRect(this);if(this.type==iio.GRID)iio.initGrid(this);else this.type=iio.RECT}this.updateProps=function(){this.center=this.pos;this.left=this.pos.x-this.width/2;this.right=this.pos.x+this.width/2;this.top=this.pos.y-this.height/2;this.bottom=this.pos.y+this.height/2};this.updateProps()}if(this.origin=="center")this.origin=this.center;iio.resolveBounds=function(e,t){if(e.length>1)return e[1](t);return true};iio.upperBoundReached=function(e,t,n){if(t>e[0])return iio.resolveBounds(e,n);return false};iio.lowerBoundReached=function(e,t,n){if(t<e[0])return iio.resolveBounds(e,n);return false};this._shrink=function(e,t){this.width*=1-e;this.height*=1-e;if(this.width<.02){if(t)return t(this);else return true}};this._update=function(e){if(this.update)this.update(e);var t=false;if(this.bounds&&!this.simple){if(this.bounds.right)t=iio.upperBoundReached(this.bounds.right,this.right,this);if(this.bounds.left)t=iio.lowerBoundReached(this.bounds.left,this.left,this);if(this.bounds.top)t=iio.lowerBoundReached(this.bounds.top,this.top,this);if(this.bounds.bottom)t=iio.upperBoundReached(this.bounds.bottom,this.bottom,this)}else if(this.bounds){if(this.bounds.right)t=iio.upperBoundReached(this.bounds.right,this.pos.x,this);if(this.bounds.left)t=iio.lowerBoundReached(this.bounds.left,this.pos.y,this);if(this.bounds.top)t=iio.lowerBoundReached(this.bounds.top,this.pos.x,this);if(this.bounds.bottom)t=iio.upperBoundReached(this.bounds.bottom,this.pos.y,this)}if(this.shrink){if(this.shrink instanceof Array)t=this._shrink(this.shrink[0],this.shrink[1]);else t=this._shrink(this.shrink)}if(t)return t;iio.V.add(this.vel,this.acc);if(this.vel.x)this.pos.x+=this.vel.x;if(this.vel.y)this.pos.y+=this.vel.y;if(this.vel.r)this.rot+=this.vel.r;if(!this.simple)this.updateProps(this.vel);if(this.objs&&this.objs.length>0)for(var n=0;n<this.objs.length;n++)if(this.objs[n]._update)if(this.objs[n]._update(e))this.rmv(this.objs[n])};this.draw=function(e){if(this.hidden)return;if(typeof e=="undefined")e=this.app.ctx;e.save();if(this.origin)e.translate(this.origin.x,this.origin.y);else e.translate(this.pos.x,this.pos.y);if(this.rot!=0)e.rotate(this.rot);if(this.objs.length>0){var t=false;for(var n=0;n<this.objs.length;n++){if(!t&&this.objs[n].z>=this.z){this.__draw(e);t=true}if(this.objs[n].draw)this.objs[n].draw(e)}if(!t)this.__draw(e)}else this.__draw(e);e.restore()};this.__draw=function(e){e.save();if(typeof this.alpha!="undefined")e.globalAlpha=this.alpha;if(this.lineCap)e.lineCap=this.lineCap;if(this.shadow){var t=this.shadow.split(" ");for(var n=0;n<t.length;n++){if(iio.isNumber(t[n]))e.shadowBlur=t[n];else if(t[n].indexOf(":")>-1){var r=t[n].indexOf(":");e.shadowOffsetX=t[n].substring(0,r);e.shadowOffsetY=t[n].substring(r+1)}else e.shadowColor=t[n]}}if(this.dash){if(this.dash.length>1&&this.dash.length%2==1)e.lineDashOffset=this.dash[this.dash.length-1];e.setLineDash(this.dash)}this._draw(e);e.restore()};this.createGradient=function(e,t){var n;var r=t.split(":");var i=r[1].split(",");if(i.length==4)n=e.createLinearGradient(this.eval(i[0]),this.eval(i[1]),this.eval(i[2]),this.eval(i[3]));else n=e.createRadialGradient(this.eval(i[0]),this.eval(i[1]),this.eval(i[2]),this.eval(i[3]),this.eval(i[4]),this.eval(i[5]));var s;for(var o=2;o<r.length;o++){s=r[o].indexOf(",");var u=parseFloat(r[o].substring(0,s));var a=this.eval(r[o].substring(s+1));n.addColorStop(u,a)}return n}};iio.prepShape=function(e,t){if(t.color){if(t.color.indexOf&&t.color.indexOf("gradient")>-1)t.color=t.createGradient(e,t.color);e.fillStyle=t.color}if(t.outline){if(t.outline.indexOf&&t.outline.indexOf("gradient")>-1)t.outline=t.createGradient(e,t.outline);e.lineWidth=t.lineWidth;e.strokeStyle=t.outline}};iio.finishPathShape=function(e,t){if(t.color)e.fill();if(t.img)e.drawImage(t.img,-t.width/2,-t.height/2,t.width,t.height);if(t.outline)e.stroke();if(t.clip)e.clip()};iio.prepX=function(e,t){e.save();if(t.xColor.indexOf&&t.xColor.indexOf("gradient")>-1)t.xColor=t.createGradient(e,t.xColor);e.strokeStyle=t.xColor;e.lineWidth=t.lineWidth};iio.initLine=function(e){e.center.x=(e.pos.x+e.endPos.x)/2;e.center.y=(e.pos.y+e.endPos.y)/2;e.width=Math.sqrt(Math.pow(e.endPos.x-e.pos.x,2)+Math.pow(e.endPos.y-e.pos.y,2));e.height=e.lineWidth;e._draw=function(t){if(e.color.indexOf&&e.color.indexOf("gradient")>-1)e.color=e.createGradient(t,e.color);t.strokeStyle=this.color;t.lineWidth=this.lineWidth;if(this.origin)t.translate(-this.origin.x,-this.origin.y);else t.translate(-this.pos.x,-this.pos.y);t.beginPath();t.moveTo(this.pos.x,this.pos.y);if(this.bezier)t.bezierCurveTo(this.bezier[0],this.bezier[1],this.bezier[2],this.bezier[3],this.endPos.x,this.endPos.y);else t.lineTo(this.endPos.x,this.endPos.y);t.stroke()};e.updateProps=function(e){iio.V.add(this.endPos,e);iio.V.add(this.center,e)}};iio.initRect=function(e){e._draw=function(e){iio.prepShape(e,this);e.translate(-this.width/2,-this.height/2);iio.drawRect(e,this.width,this.height,this.color,this.outline,this.img,this.round);if(this.xColor){iio.prepX(e,this);iio.drawLine(e,0,0,this.width,this.height);iio.drawLine(e,this.width,0,0,this.height);e.restore()}};e.contains=function(e,t){t=e.y||t;e=e.x||e;e-=this.pos.x;t-=this.pos.y;if(e>-this.width/2&&e<this.width/2&&t>-this.height/2&&t<this.height/2)return true;return false}};iio.initGrid=function(e){e.cells=[];var t=-e.res.x;var n=-e.res.y;for(var r=0;r<e.C;r++){e.cells[r]=[];for(var i=0;i<e.R;i++){e.cells[r][i]=e.add(new iio.Obj([t,n],{c:r,r:i,width:e.res.x,height:e.res.y},undefined,e));n+=e.res.y}n=-e.res.y;t+=e.res.x}e._draw=function(e){iio.prepShape(e,this);e.translate(-this.width/2,-this.height/2);iio.drawRect(e,this.width,this.height,this.color,this.outline,this.img,this.round);if(this.gridColor.indexOf&&this.gridColor.indexOf("gradient")>-1)this.gridColor=this.createGradient(e,this.gridColor);e.strokeStyle=this.gridColor;e.lineWidth=this.lineWidth;for(var t=1;t<this.C;t++)iio.drawLine(e,t*this.res.x,0,t*this.res.x,this.height);for(var n=1;n<this.R;n++)iio.drawLine(e,0,n*this.res.y,this.width,n*this.res.y)};e.cellCenter=function(e,t){return{x:-this.width/2+e*this.res.x+this.res.x/2,y:-this.height/2+t*this.res.y+this.res.y/2}};e.cellAt=function(e,t){if(e.x)return this.cells[Math.floor((e.x-this.left)/this.res.x)][Math.floor((e.y-this.top)/this.res.y)];else return this.cells[Math.floor((e-this.left)/this.res.x)][Math.floor((t-this.top)/this.res.y)]};e.foreachCell=function(e,t){var n=true;for(var r=0;r<this.C;r++)for(var i=0;i<this.R;i++){n=e(this.cells[r][i],t);if(typeof n!="undefined"&&!n)return[i,r]}}};iio.initCirc=function(e){e.type=iio.CIRC;e._draw=function(t){iio.prepShape(t,this);t.beginPath();if(this.width!=this.height){t.moveTo(0,-this.height/2);t.bezierCurveTo(this.width/2,-this.height/2,this.width/2,this.height/2,0,this.height/2);t.bezierCurveTo(-this.width/2,this.height/2,-this.width/2,-this.height/2,0,-this.height/2)}else t.arc(0,0,this.width/2,0,2*Math.PI,false);if(this.width!=this.height)t.closePath();iio.finishPathShape(t,this);if(this.xColor){t.rotate(Math.PI/4);iio.prepX(t,this);t.translate(0,-e.height/2);iio.drawLine(t,0,0,0,e.height);t.translate(0,e.height/2);iio.drawLine(t,e.width/2,0,-e.width/2,0);t.restore()}}};iio.initPoly=function(e){e.type=iio.POLY;e._draw=function(e){iio.prepShape(e,this);e.beginPath();e.moveTo(0,0);for(var t=1;t<this.vs.length;t++)e.lineTo(this.vs[t].x-this.vs[0].x,this.vs[t].y-this.vs[0].y);e.closePath();iio.finishPathShape(e,this)};e.updateProps=function(){this.center=this.pos}};iio.drawRect=function(e,t,n,r,i,s,o){if(o){e.beginPath();e.moveTo(o[0],0);e.lineTo(t-o[1],0);e.quadraticCurveTo(t,0,t,o[1]);e.lineTo(t,n-o[2]);e.quadraticCurveTo(t,n,t-o[2],n);e.lineTo(o[3],n);e.quadraticCurveTo(0,n,0,n-o[3]);e.lineTo(0,o[0]);e.quadraticCurveTo(0,0,o[0],0);e.closePath();e.stroke();e.fill();e.clip()}else{if(r)e.fillRect(0,0,t,n);if(s)e.drawImage(s,0,0,t,n);if(i)e.strokeRect(0,0,t,n)}};iio.drawLine=function(e,t,n,r,i){e.beginPath();e.moveTo(t,n);e.lineTo(r,i);e.stroke()};iio.initText=function(e){e.size=e.width;e._draw=function(e){e.font=this.size+"px "+this.font;e.textAlign=this.align;iio.prepShape(e,this);if(this.color)e.fillText(this.text,0,0);if(this.outline)e.strokeText(this.text,0,0);if(this.showCursor)this.cursor.pos.x=this.cursor.endPos.x=this.getX(this.cursor.index)};e.charWidth=function(e){e=e||0;this.app.ctx.font=this.size+"px "+this.font;return this.app.ctx.measureText(this.text.charAt(e)).width};e.getX=function(e){this.app.ctx.font=this.size+"px "+this.font;if(typeof this.align=="undefined"||this.align=="left")return this.app.ctx.measureText(this.text.substring(0,e)).width;if(this.align=="right"||this.align=="end")return-this.app.ctx.measureText(this.text.substring(0,this.text.length-e)).width;if(this.align=="center"){var t=-Math.floor(this.app.ctx.measureText(this.text).width/2);return t+this.app.ctx.measureText(this.text.substring(0,e)).width}};var t=e.getX(e.text.length);e.cursor=e.add([t,10,t,-e.size*.8],"2 "+(e.color||e.outline),{index:e.text.length,shift:false});if(e.showCursor){iio.loop(2,e.cursor,function(e,t){t.hidden=!t.hidden;t.app.draw()})}else e.cursor.hidden=true;e.keyUp=function(e){if(e=="shift")this.cursor.shift=false};e.keyDown=function(e,t,n,r){if(!iio.isNumber(t)){r=t;t=this.cursor.index}var i;var s=this.text.substring(0,t);var o=this.text.substring(t);if(typeof r!="undefined"){i=r(e,n,s,o);if(i!=false){this.text=s+i+o;this.cursor.index=t+1;if(this.showCursor)this.cursor.hidden=false;this.app.draw();return this.cursor.index}}if(e.length>1){if(e=="space"){this.text=s+" "+o;t++}else if(e=="backspace"&&t>0){this.text=s.substring(0,s.length-1)+o;t--}else if(e=="delete"&&t<this.text.length)this.text=s+o.substring(1);else if(e=="left arrow"&&t>0)t--;else if(e=="right arrow"&&t<this.text.length)t++;else if(e=="shift")this.cursor.shift=true;else if(e=="semi-colon"){if(n)this.text=s+":"+o;else this.text=s+";"+o;t++}else if(e=="equal"){if(n)this.text=s+"+"+o;else this.text=s+"="+o;t++}else if(e=="comma"){if(n)this.text=s+"<"+o;else this.text=s+","+o;t++}else if(e=="dash"){if(n)this.text=s+"_"+o;else this.text=s+"-"+o;t++}else if(e=="period"){if(n)this.text=s+">"+o;else this.text=s+"."+o;t++}else if(e=="forward slash"){if(n)this.text=s+"?"+o;else this.text=s+"/"+o;t++}else if(e=="grave accent"){if(n)this.text=s+"~"+o;else this.text=s+"`"+o;t++}else if(e=="open bracket"){if(n)this.text=s+"{"+o;else this.text=s+"["+o;t++}else if(e=="back slash"){if(n)this.text=s+"|"+o;else this.text=s+"/"+o;t++}else if(e=="close bracket"){if(n)this.text=s+"}"+o;else this.text=s+"]"+o;t++}else if(e=="single quote"){if(n)this.text=s+'"'+o;else this.text=s+"'"+o;t++}}else{if(n||this.cursor.shift)this.text=s+e.charAt(0).toUpperCase()+o;else this.text=s+e+o;t++}if(this.showCursor)this.cursor.hidden=false;this.cursor.index=t;this.app.draw();return t}};iio.V={};iio.V.add=function(e,t){for(var n in t)if(e[n])e[n]+=t[n]};iio.V.sub=function(e,t){for(var n in t)if(e[n])e[n]-=t[n]};iio.V.mult=function(e,t){for(var n in t)if(e[n])e[n]*=t[n]};iio.V.div=function(e,t){for(var n in t)if(e[n])e[n]/=t[n]}})()